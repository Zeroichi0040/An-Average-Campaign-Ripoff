<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An Average Campgain Ripoff</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            gap: 20px;
        }
        
        .game-container {
            width: 600px;
            height: 500px;
            background-color: #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        .info-panel {
            width: 250px;
            height: 500px;
            background-color: #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        
        .current-class {
            margin-bottom: 10px;
            font-style: italic;
            text-align: center;
        }
        
        .darker-window {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            padding: 20px;
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 80%;
        }
        
        .button {
            background-color: #4a4a4a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .button:hover {
            background-color: #5a5a5a;
        }
        
        .back-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: #4a4a4a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .class-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 80%;
        }
        
        .class-button {
            background-color: #4a4a4a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .class-button:hover {
            background-color: #5a5a5a;
        }
        
        .class-description {
            margin-top: 5px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            text-align: center;
            display: none;
        }
        
        .ability-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
            position: relative;
        }
        
        .ability-button {
            background-color: #3a3a3a;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .ability-button:hover {
            background-color: #4a4a4a;
        }
        
        .ability-button:disabled {
            background-color: #2a2a2a;
            cursor: not-allowed;
        }
        
        .ability-button.cooldown {
            background-color: #2a2a2a;
            opacity: 0.7;
        }
        
        .cooldown-timer {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #e94560;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .battle-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .enemy-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .enemy {
            background-color: #d0d0d0;
            border-radius: 5px;
            padding: 10px;
            width: 120px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .enemy.highlighted {
            border: 2px solid #e94560;
            transform: scale(1.05);
        }
        
        .enemy.active-turn {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(233, 69, 96, 0.5);
        }
        
        .enemy-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-button {
            background-color: #3a3a3a;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .stat-button:hover {
            background-color: #4a4a4a;
        }
        
        .stat-button:disabled {
            background-color: #2a2a2a;
            cursor: not-allowed;
        }
        
        .ability-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: 100%;
            overflow-y: auto;
        }
        
        .ability-item {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
        }
        
        .ability-item.active {
            background-color: rgba(0, 0, 0, 0.1);
            border-left: 3px solid #4a4a4a;
        }
        
        .ability-details {
            margin-top: 10px;
            font-size: 12px;
            display: none;
        }
        
        .action-log {
            margin-top: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            height: 80px;
            overflow-y: auto;
            font-size: 12px;
        }
        
        .status-effects {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
        }
        
        .ability-info {
            margin-top: 10px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 5px;
            width: 80%;
            text-align: center;
            font-size: 14px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="info-panel" id="info-panel">
        <div class="title">Abilities</div>
        <div class="ability-list" id="ability-list">
        </div>
    </div>
    
    <div class="game-container">
        <div class="title" id="title">An Average Campgain Ripoff</div>
        <div class="current-class" id="current-class-display">Current Class: Warrior</div>
        <div class="darker-window" id="game-window">
        </div>
    </div>

    <script>
        const gameState = {
            currentMenu: 'main',
            playerClass: 'Warrior',
            playerStats: { STR: 0, DEX: 0, CON: 0 },
            player: { 
                maxHp: 30, 
                currentHp: 30, 
                energy: 0, 
                critChance: 15, 
                critDamage: 130,
                statusEffects: [],
                abilityCooldowns: {}
            },
            enemies: [],
            turnCount: 1,
            statPoints: 5,
            selectedAbility: null,
            selectedTarget: null,
            actionLog: [],
            selectedClassDescription: null
        };

        const classes = {
            Warrior: {
                description: 'A melee fighter, with a balance of damage and health. Builds STR and CON.'
            },
            Rogue: {
                description: 'A melee fighter, with a focus of high single target damage. Builds DEX.'
            }
        };

        const abilities = {
            Strike: {
                name: 'Strike',
                description: 'A simple attack that deals moderate damage.',
                damage: 6.0,
                cost: 0,
                cooldown: 0,
                damageType: 'Physical',
                targetType: 'Single Target',
                compatibleWeapons: ['Fist', 'Sword', 'Dagger'],
                scaling: { STR: 0.02, DEX: 0.01 }
            },
            'Cross Slash': {
                name: 'Cross Slash',
                description: 'Unleash two devastating slashes.',
                damage: 8,
                cost: 2,
                cooldown: 4,
                damageType: 'Physical',
                targetType: 'Single Target',
                compatibleWeapons: ['Sword'],
                scaling: { STR: 0.012 },
                hits: 2
            },
            Stab: {
                name: 'Stab',
                description: 'A swift thrust from an unforeseen angle.',
                damage: 8,
                cost: 1,
                cooldown: 4,
                damageType: 'Physical',
                targetType: 'Single Target',
                compatibleWeapons: ['Dagger'],
                scaling: { DEX: 0.015 },
                statusEffect: 'Bleed'
            },
            Bite: {
                name: 'Bite',
                description: 'A quick bite attack.',
                damage: 2,
                cost: 0,
                cooldown: 0,
                damageType: 'Physical',
                targetType: 'Single Target'
            }
        };

        function initGame() {
            renderMainMenu();
        }

        function renderMainMenu() {
            gameState.currentMenu = 'main';
            document.getElementById('title').textContent = 'An Average Campgain Ripoff';
            document.getElementById('current-class-display').textContent = `Current Class: ${gameState.playerClass}`;
            document.getElementById('info-panel').style.display = 'none';
            
            const gameWindow = document.getElementById('game-window');
            gameWindow.innerHTML = `
                <div class="button-container">
                    <button class="button" id="start-adventure">Start Adventure</button>
                    <button class="button" id="change-class">Change Class</button>
                </div>
            `;
            
            document.getElementById('start-adventure').addEventListener('click', startAdventure);
            document.getElementById('change-class').addEventListener('click', renderChangeClassMenu);
        }

        function renderChangeClassMenu() {
            gameState.currentMenu = 'changeClass';
            document.getElementById('title').textContent = 'Change Class';
            document.getElementById('info-panel').style.display = 'none';
            
            const gameWindow = document.getElementById('game-window');
            gameWindow.innerHTML = `
                <div class="class-container">
                    <button class="class-button" id="warrior-class">Warrior</button>
                    <div class="class-description" id="warrior-description">${classes.Warrior.description}</div>
                    <button class="class-button" id="rogue-class">Rogue</button>
                    <div class="class-description" id="rogue-description">${classes.Rogue.description}</div>
                </div>
                <button class="back-button" id="back-button">Back</button>
            `;
            
            document.getElementById('warrior-class').addEventListener('click', () => toggleClassDescription('warrior'));
            document.getElementById('rogue-class').addEventListener('click', () => toggleClassDescription('rogue'));
            document.getElementById('back-button').addEventListener('click', renderMainMenu);
        }

        function toggleClassDescription(className) {
            const descriptionElement = document.getElementById(`${className}-description`);
            const isVisible = descriptionElement.style.display === 'block';

            document.querySelectorAll('.class-description').forEach(desc => {
                desc.style.display = 'none';
            });

            if (!isVisible) {
                descriptionElement.style.display = 'block';
                gameState.playerClass = className.charAt(0).toUpperCase() + className.slice(1);
                document.getElementById('current-class-display').textContent = `Current Class: ${gameState.playerClass}`;
            }
        }

        function startAdventure() {
            gameState.currentMenu = 'statAllocation';
            document.getElementById('title').textContent = 'Allocate Stat Points';
            document.getElementById('current-class-display').style.display = 'none';
            document.getElementById('info-panel').style.display = 'none';
            
            const gameWindow = document.getElementById('game-window');
            gameWindow.innerHTML = `
                <div>You have ${gameState.statPoints} points to allocate</div>
                <div class="stat-container">
                    <div>STR: ${gameState.playerStats.STR}</div>
                    <button class="stat-button" id="increase-str">+</button>
                </div>
                <div class="stat-container">
                    <div>DEX: ${gameState.playerStats.DEX}</div>
                    <button class="stat-button" id="increase-dex">+</button>
                </div>
                <div class="stat-container">
                    <div>CON: ${gameState.playerStats.CON}</div>
                    <button class="stat-button" id="increase-con">+</button>
                </div>
                <div class="stat-container">
                    <button class="button" id="finish-allocation">Finish</button>
                </div>
            `;
            
            document.getElementById('increase-str').addEventListener('click', () => increaseStat('STR'));
            document.getElementById('increase-dex').addEventListener('click', () => increaseStat('DEX'));
            document.getElementById('increase-con').addEventListener('click', () => increaseStat('CON'));
            document.getElementById('finish-allocation').addEventListener('click', startEncounter);
            
            updateStatButtons();
        }

        function increaseStat(stat) {
            if (gameState.statPoints > 0) {
                gameState.playerStats[stat]++;
                gameState.statPoints--;
                
                if (stat === 'CON') {
                    gameState.player.maxHp = 30 + gameState.playerStats.CON;
                    gameState.player.currentHp = gameState.player.maxHp;
                } else if (stat === 'STR' || stat === 'DEX') {
                    gameState.player.critChance = 15 + (gameState.playerStats.STR + gameState.playerStats.DEX) * 0.1;
                    gameState.player.critDamage = 130 + (gameState.playerStats.STR + gameState.playerStats.DEX) * 0.2;
                }
                
                startAdventure();
            }
        }

        function updateStatButtons() {
            const buttons = ['increase-str', 'increase-dex', 'increase-con'];
            buttons.forEach(buttonId => {
                const button = document.getElementById(buttonId);
                button.disabled = gameState.statPoints <= 0;
            });
        }

        function startEncounter() {
            gameState.currentMenu = 'battle';
            document.getElementById('title').textContent = 'Encounter';
            document.getElementById('current-class-display').style.display = 'block';
            document.getElementById('info-panel').style.display = 'block';

            gameState.enemies = [
                { 
                    name: 'Rat 1', 
                    maxHp: Math.floor(Math.random() * 4) + 5, 
                    currentHp: 0, 
                    energy: 0,
                    maxEnergy: 4,
                    statusEffects: []
                },
                { 
                    name: 'Rat 2', 
                    maxHp: Math.floor(Math.random() * 4) + 5, 
                    currentHp: 0, 
                    energy: 0,
                    maxEnergy: 4,
                    statusEffects: []
                }
            ];

            gameState.enemies.forEach(enemy => {
                enemy.currentHp = enemy.maxHp;
            });
            
            gameState.turnCount = 1;
            gameState.player.energy = 1;
            gameState.actionLog = [];
            gameState.player.abilityCooldowns = {};
            
            renderBattle();
            updateAbilityList();
            addToLog("Your turn.");
        }

        function renderBattle() {
            const gameWindow = document.getElementById('game-window');
            gameWindow.innerHTML = `
                <div class="battle-info">
                    <div>Turn: ${gameState.turnCount}</div>
                    <div>HP: ${gameState.player.currentHp.toFixed(1)}/${gameState.player.maxHp}</div>
                    <div>Energy: ${gameState.player.energy}/6</div>
                </div>
                <div class="enemy-container">
                    ${gameState.enemies.map((enemy, index) => `
                        <div class="enemy" id="enemy-${index}" data-index="${index}">
                            <div class="enemy-name">${enemy.name}</div>
                            <div>HP: ${enemy.currentHp.toFixed(1)}/${enemy.maxHp.toFixed(1)}</div>
                            <div>Energy: ${enemy.energy}/${enemy.maxEnergy}</div>
                            ${enemy.statusEffects.length > 0 ? 
                                `<div class="status-effects">${enemy.statusEffects.map(effect => effect.type).join(', ')}</div>` : 
                                ''}
                        </div>
                    `).join('')}
                </div>
                <div class="ability-container">
                    ${getClassAbilities().map(abilityName => {
                        const ability = abilities[abilityName];
                        const canUse = gameState.player.energy >= ability.cost && 
                                      (!gameState.player.abilityCooldowns[abilityName] || 
                                       gameState.player.abilityCooldowns[abilityName] === 0);
                        const cooldown = gameState.player.abilityCooldowns[abilityName] || 0;
                        return `
                            <button class="ability-button ${cooldown > 0 ? 'cooldown' : ''}" 
                                    data-ability="${abilityName}" ${!canUse ? 'disabled' : ''}>
                                ${abilityName}
                                ${cooldown > 0 ? `<div class="cooldown-timer">${cooldown}</div>` : ''}
                            </button>
                        `;
                    }).join('')}
                </div>
                <div class="ability-info" id="ability-info"></div>
                <div class="action-log">
                    ${gameState.actionLog.map(entry => `<div>${entry}</div>`).join('')}
                </div>
            `;
            
            document.querySelectorAll('.ability-button').forEach(button => {
                const abilityName = button.getAttribute('data-ability');
                button.addEventListener('click', () => selectAbility(abilityName));
            });
        }

        function getClassAbilities() {
            const baseAbilities = ['Strike'];
            if (gameState.playerClass === 'Warrior') {
                baseAbilities.push('Cross Slash');
            } else if (gameState.playerClass === 'Rogue') {
                baseAbilities.push('Stab');
            }
            return baseAbilities;
        }

        function updateAbilityList() {
            const abilityList = document.getElementById('ability-list');
            abilityList.innerHTML = '';
            
            getClassAbilities().forEach(abilityName => {
                const ability = abilities[abilityName];
                const abilityItem = document.createElement('div');
                abilityItem.className = 'ability-item';
                abilityItem.innerHTML = `
                    <div>${ability.name}</div>
                    <div class="ability-details"></div>
                `;
                
                abilityItem.addEventListener('click', function() {
                    const details = this.querySelector('.ability-details');
                    const isActive = this.classList.contains('active');

                    document.querySelectorAll('.ability-item').forEach(item => {
                        item.classList.remove('active');
                        item.querySelector('.ability-details').style.display = 'none';
                    });

                    if (!isActive) {
                        this.classList.add('active');
                        details.style.display = 'block';
                        details.innerHTML = `
                            <div>${ability.description}</div>
                            <div>Damage: ${ability.damage}</div>
                            <div>Cost: ${ability.cost}</div>
                            <div>Cooldown: ${ability.cooldown}</div>
                            <div>Damage Type: ${ability.damageType}</div>
                            <div>Target Type: ${ability.targetType}</div>
                            <div>Compatible Weapons: ${ability.compatibleWeapons.join(', ')}</div>
                            ${ability.statusEffect ? `<div>Status Effect: ${ability.statusEffect}</div>` : ''}
                            <div>Scaling: ${Object.entries(ability.scaling).map(([stat, value]) => 
                                `${stat}: ${value}`).join(', ')}
                            </div>
                            ${ability.hits ? `<div>Hits: ${ability.hits}</div>` : ''}
                        `;
                    }
                });
                
                abilityList.appendChild(abilityItem);
            });
        }

        function selectAbility(abilityName) {
            gameState.selectedAbility = abilityName;
            const ability = abilities[abilityName];
            
            // Show ability info
            const abilityInfo = document.getElementById('ability-info');
            const currentDamage = calculateAbilityDamage(ability);
            abilityInfo.innerHTML = `
                <div>Current Damage: ${currentDamage.toFixed(1)}</div>
                <div>CD: ${ability.cooldown}</div>
            `;
            abilityInfo.style.display = 'block';
            
            if (ability.targetType === 'Single Target') {
                document.querySelectorAll('.enemy').forEach(enemy => {
                    enemy.classList.add('highlighted');
                });
                
                document.querySelectorAll('.enemy').forEach(enemy => {
                    enemy.addEventListener('click', targetEnemy);
                });
            } else {
                useAbility(null);
            }
        }

        function calculateAbilityDamage(ability) {
            let baseDamage = ability.damage;
            let totalScaling = 0;
            
            Object.keys(ability.scaling).forEach(stat => {
                totalScaling += baseDamage * ability.scaling[stat] * gameState.playerStats[stat];
            });
            
            return baseDamage + totalScaling;
        }

        function targetEnemy(event) {
            const enemyIndex = parseInt(event.currentTarget.getAttribute('data-index'));
            gameState.selectedTarget = enemyIndex;
            
            document.querySelectorAll('.enemy').forEach(enemy => {
                enemy.classList.remove('highlighted');
                enemy.removeEventListener('click', targetEnemy);
            });
            
            useAbility(enemyIndex);
        }

        function useAbility(targetIndex) {
            const abilityName = gameState.selectedAbility;
            const ability = abilities[abilityName];
            
            if (gameState.player.energy < ability.cost) {
                addToLog('Not enough energy!');
                return;
            }
            
            // Clear ability info
            document.getElementById('ability-info').style.display = 'none';
            
            // Clear log and show player action
            clearLog();
            addToLog(`Player used ${abilityName} on ${gameState.enemies[targetIndex].name}, dealing ${calculateAbilityDamage(ability).toFixed(1)} damage!`);
            
            // Apply ability cooldown
            if (ability.cooldown > 0) {
                gameState.player.abilityCooldowns[abilityName] = ability.cooldown;
            }
            
            let totalDamage = 0;
            let hits = ability.hits || 1;
            let hitResults = [];
            
            for (let i = 0; i < hits; i++) {
                let baseDamage = ability.damage;
                let totalScaling = 0;
                
                Object.keys(ability.scaling).forEach(stat => {
                    totalScaling += baseDamage * ability.scaling[stat] * gameState.playerStats[stat];
                });
                
                let damage = baseDamage + totalScaling;
                
                const isCrit = Math.random() * 100 < gameState.player.critChance;
                if (isCrit) {
                    damage *= gameState.player.critDamage / 100;
                    hitResults.push({ damage, isCrit: true });
                } else {
                    hitResults.push({ damage, isCrit: false });
                }
                
                totalDamage += damage;
            }
            
            if (targetIndex !== null && targetIndex !== undefined) {
                const targetEnemy = gameState.enemies[targetIndex];
                
                // Apply damage instantly
                hitResults.forEach((hit) => {
                    targetEnemy.currentHp -= hit.damage;
                    if (targetEnemy.currentHp < 0) targetEnemy.currentHp = 0;
                });

                // Update battle display immediately
                renderBattle();
                
                if (ability.statusEffect) {
                    targetEnemy.statusEffects.push({
                        type: ability.statusEffect,
                        duration: 1
                    });
                    addToLog(`Inflicted ${ability.statusEffect}`);
                }
                
                gameState.player.energy -= ability.cost;

                if (gameState.enemies.every(enemy => enemy.currentHp <= 0)) {
                    setTimeout(() => {
                        clearLog();
                        addToLog('You defeated all enemies!');
                        setTimeout(() => {
                            renderMainMenu();
                        }, 1500);
                    }, 1000);
                    return;
                }

                // Clear log and start enemy turn
                setTimeout(() => {
                    clearLog();
                    enemyTurn();
                }, 1000);
            }
            
            gameState.selectedAbility = null;
            gameState.selectedTarget = null;
        }

        function enemyTurn() {
            gameState.turnCount++;
            
            // Process enemy turns one by one
            let enemyIndex = 0;
            const processEnemyTurn = () => {
                if (enemyIndex >= gameState.enemies.length) {
                    // All enemies have taken their turn
                    gameState.player.energy = Math.min(gameState.player.energy + 1, 6);
                    
                    // Reduce cooldowns
                    Object.keys(gameState.player.abilityCooldowns).forEach(abilityName => {
                        if (gameState.player.abilityCooldowns[abilityName] > 0) {
                            gameState.player.abilityCooldowns[abilityName]--;
                        }
                    });
                    
                    renderBattle();
                    
                    // Clear log and show player turn message
                    setTimeout(() => {
                        clearLog();
                        addToLog("Your turn.");
                    }, 800);
                    
                    return;
                }
                
                const enemy = gameState.enemies[enemyIndex];
                
                if (enemy.currentHp > 0) {
                    const enemyElement = document.getElementById(`enemy-${enemyIndex}`);
                    enemyElement.classList.add('active-turn');
                    
                    // Process status effects first
                    const bleedIndex = enemy.statusEffects.findIndex(effect => effect.type === 'Bleed');
                    if (bleedIndex !== -1) {
                        enemy.currentHp -= 3.0;
                        if (enemy.currentHp < 0) enemy.currentHp = 0;
                        
                        clearLog();
                        addToLog(`${enemy.name} took 3.0 damage from Bleed`);
                        
                        enemy.statusEffects.splice(bleedIndex, 1);
                        
                        if (enemy.currentHp <= 0) {
                            clearLog();
                            addToLog(`${enemy.name} died`);
                            
                            if (gameState.enemies.every(e => e.currentHp <= 0)) {
                                clearLog();
                                addToLog('You defeated all enemies!');
                                setTimeout(() => {
                                    renderMainMenu();
                                }, 1500);
                                return;
                            }
                            
                            enemyIndex++;
                            setTimeout(processEnemyTurn, 800);
                            return;
                        }
                        
                        // Update battle display
                        renderBattle();
                    }
                    
                    // Enemy attacks if still alive
                    if (enemy.currentHp > 0) {
                        setTimeout(() => {
                            gameState.player.currentHp -= 2;
                            if (gameState.player.currentHp < 0) gameState.player.currentHp = 0;
                            
                            clearLog();
                            addToLog(`${enemy.name} used Bite on Player`);
                            
                            enemyElement.classList.remove('active-turn');
                            
                            if (gameState.player.currentHp <= 0) {
                                clearLog();
                                addToLog('You have been defeated!');
                                setTimeout(() => {
                                    renderMainMenu();
                                }, 1500);
                                return;
                            }
                            
                            enemy.energy = Math.min(enemy.energy + 1, enemy.maxEnergy);
                            enemyIndex++;
                            setTimeout(processEnemyTurn, 800);
                        }, 500);
                    } else {
                        enemyIndex++;
                        setTimeout(processEnemyTurn, 100);
                    }
                } else {
                    enemyIndex++;
                    setTimeout(processEnemyTurn, 100);
                }
            };
            
            processEnemyTurn();
        }

        function addToLog(message) {
            gameState.actionLog.unshift(message);
            if (gameState.actionLog.length > 5) {
                gameState.actionLog.pop();
            }
            updateLogDisplay();
        }

        function clearLog() {
            gameState.actionLog = [];
            updateLogDisplay();
        }

        function updateLogDisplay() {
            const actionLogElement = document.querySelector('.action-log');
            if (actionLogElement) {
                actionLogElement.innerHTML = gameState.actionLog.map(entry => `<div>${entry}</div>`).join('');
            }
        }

        window.onload = initGame;
    </script>
</body>
</html>